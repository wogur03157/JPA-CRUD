<!DOCTYPE html>
<html lang="ko">
<head>
  <title>결제하기</title>
  <meta charset="utf-8">
  <script src="https://js.tosspayments.com/v1"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>
<body>
<section>
  <!-- ... -->
  <span>총 주문금액</span>
  <span>3000 원</span>
  <button type="button" id="payment-button">3000원 결제하기</button>
  <button type="button" id="list">list</button>
  <button type="button" id="insmem">회원가입</button>
  <button type="button" id="salesMember">insMember</button>
  <button type="button" id="cancel">cancel</button>
  <button type="button" id="login">login</button>
  <button type="button" id="email">email</button>
  <button type="button" id="send">send</button>
  <button type="button" name="sms"id="sms">sms</button>
  <button type="button" id="sm">sm</button>
  <button type="button" id="remail">email</button>
  <button type="button" id="mem">mem</button>
  <button type="button" id="asdf">asdf</button>
  <button type="button" id="app">asdf</button>
  <button type="button" id="kaka">kaka</button>
  <button type="button" id="token">token</button>
  <button type="button" id="sendkaak">sendkaak</button>
  <button type="button" id="delre">delseq</button>
  <button type="button" id="reservation">reservation</button>
  <button type="button" id="easycard">reservation</button>
  <button type="button" id="salesbenefit">salesbenefit</button>
  <button type="button" id="saleslist">saleslist</button>
  <button id="sub">구독 정보</button>
  <button id="subCancel">구독 취소</button>



  <form name="smsform" method="POST" action="http://link.smsceo.co.kr/sendsms_utf8.php">
    <input type="hidden" name="userkey" value="BzxQZV1sDzVSYAdmUX4HOFZmB3QAM1MuA34=">
    <input type="hidden" name="userid" value="mever">
    <input type="hidden" name="msg" value="안녕하세요. 문자대표입니다.">
    <input type="hidden" name="phone" value="01063645022">
    <input type="hidden" name="callback" value="01072818209">
    <input type="hidden" name="return_url" value="http://localhost:8080/send/sms/success?email=test@tst.com&phone=01012341234&url=http://localhost:8080/">
    <input type="hidden" name="return_var" value="">
  </form>
  <div class="container">
    <h1 class="page-header">Chat</h1>

    <table class="table table-bordered">
      <tr>
        <td><input type="text" name="user" id="user" class="form-control" placeholder="유저명"></td>
        <td>
          <button type="button" class="btn btn-default" id="btnConnect">연결</button>
          <button type="button" class="btn btn-default" id="btnDisconnect" disabled>종료</button>
        </td>
      </tr>
      <tr>
        <td colspan="2"><div id="lists"></div></td>
      </tr>
      <tr>
        <td colspan="2"><input type="text" name="msg" id="msg" placeholder="대화 내용을 입력하세요." class="form-control" disabled>
          <button type="button" class="btn btn-default" id="btnSend" disabled>전송</button>
        <button type="button" class="btn btn-default" id="asdfadsfa" >asdfadsfa</button></td>
      </tr>
    </table>
  </div>


</section>
<script>
  function stringToUtf8Bytes(text){
    var result = [] ;
    if(text != null){
      for (i = 0; i<text.length; i++) {
        var c = text.charCodeAt(i);
        if (c <= 0x7f) {
          result.push(c);
        } else if (c <= 0x07ff) {
          result.push(((c >> 6) & 0x1F) | 0xC0);
          result.push((c & 0x3F) | 0x80);
        } else {
          result.push(((c >> 12) & 0x0F) | 0xE0);
          result.push(((c >> 6) & 0x3F) | 0x80);
          result.push((c & 0x3F) | 0x80);
        }
      }
    }
    return result;
  }
  // 채팅 서버 주소
  //let url = "ws://api.mever.me:12000";
  let url = "ws://localhost:8080";
  // let url = "ws://localhost:8080/websocket";
  // 웹 소켓
  let ws;
  // 연결하기
  $('#btnConnect').click(function() {

    // 유저명 확인
    if ($('#user').val().trim() != '') {
      // 연결
      ws = new WebSocket(url);

      // 소켓 이벤트 매핑
      ws.onopen = function (evt) {
        // console.log('서버 연결 성공');
        print($('#user').val(), '입장했습니다.');

        // 현재 사용자가 입장했다고 서버에게 통지(유저명 전달)
        // -> 1#유저명
        ws.send('1#' + $('#user').val() + '#');

        $('#user').attr('readonly', true);
        $('#btnConnect').attr('disabled', true);
        $('#btnDisconnect').attr('disabled', false);
        $('#btnSend').attr('disabled', false);
        $('#msg').attr('disabled', false);
        $('#msg').focus();
      };

      ws.onmessage = function (evt) {
        // print('', evt.data);
        let index = evt.data.indexOf("#", 2);
        let no = evt.data.substring(0, 1);
        let user = evt.data.substring(2, index);
        let txt = evt.data.substring(index + 1);

        if (no == '1') {
          print2(user);
        } else if (no == '2') {
          print(user, txt);
        } else if (no == '3') {
          print3(user);
        }
        $('#lists').scrollTop($('#lists').prop('scrollHeight'));
      };

      ws.onclose = function (evt) {
        console.log('소켓이 닫힙니다.');
      };

      ws.onerror = function (evt) {
        console.log(evt.data);
      };
    } else {
      alert('유저명을 입력하세요.');
      $('#user').focus();
    }
  });
  // 메세지 전송 및 아이디
  function print(user, txt) {
    let temp = '';
    temp += '<div style="margin-bottom:3px;">';
    temp += '[' + user + '] ';
    temp += txt;
    temp += ' <span style="font-size:11px;color:#777;">' + new Date().toLocaleTimeString() + '</span>';
    temp += '</div>';
    $('#lists').append(temp);
  }
  // 다른 client 접속
  function print2(user) {
    let temp = '';
    temp += '<div style="margin-bottom:3px;">';
    temp += ' <span style="color:skyblue;">' + "'" + user + "' 이(가) 접속했습니다." + '</span>';
    temp += ' <span style="font-size:11px;color:skyblue;">' + new Date().toLocaleTimeString() + '</span>';
    temp += '</div>';
    $('#lists').append(temp);
  }
  // client 접속 종료
  function print3(user) {
    let temp = '';
    temp += '<div style="margin-bottom:3px;">';
    temp += ' <span style="color:blue;">' + "'" + user + "' 이(가) 종료했습니다." + '</span>';
    temp += ' <span style="font-size:11px;color:blue;">' + new Date().toLocaleTimeString() + '</span>';
    temp += '</div>';
    $('#lists').append(temp);
  }

  $("#btnSend").on('click',function(){
    ws.send('2#' + $('#user').val() + '#' + $("#msg").val()); //서버에게
    ws.send($("#msg").val()); //서버에게
    print($('#user').val(), $("#msg").val()); //본인 대화창에
    $('#msg').val('');
    $('#msg').focus();
  });
  $("#asdfadsfa").on('click',function(){
    console.log(new TextEncoder().encode($("#msg").val()));
    ws.send( new TextEncoder().encode($("#msg").val())); //서버에게
    print($('#user').val(), $("#msg").val()); //본인 대화창에
    $('#msg').val('');
    $('#msg').focus();
  });
  $('#user').keydown(function() {
    if (event.keyCode == 13) {
      $('#btnConnect').click();
    }
  });
  $('#msg').keydown(function() {
    if (event.keyCode == 13) {
      //서버에게 메시지 전달
      //2#유저명#메시지
      ws.send('2#' + $('#user').val() + '#' + $(this).val()); //서버에게
      ws.send($(this).val()); //서버에게
      print($('#user').val(), $(this).val()); //본인 대화창에
      $('#msg').val('');
      $('#msg').focus();
    }
  });
  $('#btnDisconnect').click(function() {
    ws.send('3#' + $('#user').val() + '#');
    ws.close();
    $('#user').attr('readonly', false);
    $('#user').val('');
    $('#btnConnect').attr('disabled', false);
    $('#btnDisconnect').attr('disabled', true);
    $('#btnSend').attr('disabled', true);
    $('#msg').val('');
    $('#msg').attr('disabled', true);
  });
</script>
<script>
  var clientKey = 'test_ck_OyL0qZ4G1VOmmAG4JOP8oWb2MQYg'
  var tossPayments = TossPayments(clientKey)

  $("#reservation").on('click',function(){
    $.ajax({
      type : "post",
      url : "/send/reservation/list",
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#delre").on('click',function(){
    $.ajax({
      type : "post",
      url : "/send/reservation/delete",
      data:{seq:"68"},
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#salesbenefit").on('click',function(){
    $.ajax({
      type : "POST",
      url : "/sales/2/franchiseFee",
      contentType: "application/json",
      data:JSON.stringify({
        amount:"200000"
      }),
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#saleslist").on('click',function(){
    $.ajax({
      type : "POST",
      url : "/sales/settle/list",
      data:{email:"test3"},
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#asdf").on('click',function(){
    $.ajax({
      type : "post",
      url : "/send/list",
      data:{type:"mail"},
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#list").on('click',function(){
    $.ajax({
      type : "post",
      url : "/paymentList",
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#sub").on('click',function(){
    $.ajax({
      type : "POST",
      url : "/subscription/list",
      contentType: "application/json",
      data:JSON.stringify({
        email:"testsub@naver.com",
        phone:"01023232323"
      }),
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#subCancel").on('click',function(){
    $.ajax({
      type : "post",
      url : "/subCancel",
      data:{
        // cancelReason:'qersad',
        billingKey: 'f2m9W1H0k1YuS8vlxvS8RXgsuIKWuxse15YM4YP3AP8=',
      },
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })

  $("#app").on('click',function(){
    $.ajax({
      type : "post",
      url : "/insMember",
      contentType: 'application/json',
      data: JSON.stringify({email:"fsdkjflksj@gmail" ,appointment:"2023-05-16"}),
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#insmem").on('click',function(){
    $.ajax({
      url: '/setReservation',
      method: 'POST',
      contentType: "application/json",
      data: JSON.stringify({
        email: "sub@mever.me",
        phone: "01023775763",
        reservationDate: "2023-07-24 17:13:40",
        insertDate:"2023-07-24 17:13:40",
        orderId: "viLLiv",
        category: "/modelhouse1/",
        memo: "심운보",
        name: "심운보",
        reserPrice: 0,
        message: "asd"
      }),
      success: function (response) {
        alert("예약이 완료되었습니다.")
      },
      error: function (xhr, status, error) {

        alert("예약 할 수 없습니다." + reservationDate + "에 이미 예약 되었습니다.")
        console.log(error);
      }
    })
  });
  $("#salesMember").on('click',function(){
    $.ajax({
      type : "post",
      url : "/insMember",
      data:{
        email:'qersad',
        phone: '01012341234',
        survey: '상품',
        dcrp: '홍길동'
      },
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })

  $("#cancel").on('click',function(){
    $.ajax({
      type : "post",
      url : "/cancelOrder",
      data:{
        cancelReason:'qersad',
        paymentKey: 'xMBvpmjnoD4yKeq5bgrp2dNZEg1Ym43GX0lzW6YOQJ1w9NLR',
      },
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })

  $("#login").on('click',function(){
    $.ajax({
      type : "post",
      contentType: 'application/json',
      url : "/chkLogin",
      data: JSON.stringify({
        email:'test',
        phone: '123',
        password: '12'
      }),
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#sms").on('click',function(){
    $.ajax({
      type : "post",
      url : "/send/sms",
      data:  {
        phone:"01063645022",
        email:"ajh@mever.me"
      },
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#easycard").on('click',function(){
    $.ajax({
      url:"/payment/easyCard",
      type: "POST",
      contentType: 'application/json',
      data:JSON.stringify({ "approvalNum": "data.RS09", "cardNum":"data.RQ04" ,"Installment":"data.RQ06", "amount":"100", "vat":"13",
        "success":"data.RS04","approvedAt":"data.RS07", "orderId":"data.RS08","cardType":"data.RS10"}),
      success: function (data) {
        alert("결제가 완료되었습니다.")
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })

  $("#kaka").on('click',function(){
    $.ajax({
      type : "GET",
      url : "/getFriends",
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })

  $("#token").on('click',function(){
    $.ajax({
      type : "post",
      url : "/getKakaoAccessToken",
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#sendkaak").on('click',function(){
    $.ajax({
      type : "get",
      url : "/sendNotification",
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#remail").on('click',function(){
    $.ajax({
      type : "post",
      contentType: 'application/json',
      url : "/send/reservation/mail",
      data: JSON.stringify([{
        email:'ajh@mever.me',
        title: 'test',
        content: 'test',
        period: 'day'
      },{
        email:'ajh@test.me',
        title: 'test',
        content: 'test',
        period: 'week'
      },{
        email:'ajh@eeee.me',
        title: 'test',
        content: 'test',
        period: 'month'
      }]),
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })
  $("#send").on('click',function(){
    $.ajax({
      type : "post",
      contentType: 'application/json',
      url : "/automail",
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })

  $("#mem").on('click',function(){
    $.ajax({
      type : "post",
      url : "/salesMember/list",
      data:{email:"korea@me.kr"},
      success : function (res) {
        console.log(res)
      },
      error : function (status) {
        alert(status + "error!");
      }
    });
  })

  $("#sm").on('click',function(){
    document.smsform.submit();
  })
</script>
</body>
</html>